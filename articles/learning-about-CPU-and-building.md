---
title: "CPUについて学び，実際に創ってみた"
date: "2021-07-26"
---

## **はじめに**

昨年から積読として本棚にいた「[CPUの創りかた](https://www.amazon.co.jp/dp/4839909865/ref=cm_sw_r_tw_dp_XFQETV7GGC57VJBSVWF3)」という本を取り出して，CPUについて学んだ後，実際にICチップや抵抗などの電子部品を半田付けをしてラーメンタイマーを作成するところまでやってみたので，学んだことなどについて書いてみたいなと思い，この記事を書くことにしました．

本を読んでいたのは四月上旬から五月下旬位だった気がしてます．勉強会で知り合った方と二週間間隔で輪読をしながら進めていくという形をとりました．本を読み終わった後は，各自で既に購入していた電子部品などを半田付けして自分の場合は七月中旬にラーメンタイマーが完成したという流れでした．

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">読み終わったので作ります<br>適当にタグつけて作っていく過程をあげていこう<a href="https://twitter.com/hashtag/jdkfx_td4?src=hash&amp;ref_src=twsrc%5Etfw">#jdkfx_td4</a> <a href="https://t.co/Mr2L0OwfyO">pic.twitter.com/Mr2L0OwfyO</a></p>&mdash; はる茶 / Haruki Tazoe 🍒 (@jdkfx) <a href="https://twitter.com/jdkfx/status/1395979443126947843?ref_src=twsrc%5Etfw">May 22, 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">完成！！やったあああ！！<br><br> <a href="https://twitter.com/hashtag/jdkfx_td4?src=hash&amp;ref_src=twsrc%5Etfw">#jdkfx_td4</a> <a href="https://t.co/mGxTLY6WMd">pic.twitter.com/mGxTLY6WMd</a></p>&mdash; はる茶 / Haruki Tazoe 🍒 (@jdkfx) <a href="https://twitter.com/jdkfx/status/1414229006744887301?ref_src=twsrc%5Etfw">July 11, 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

完成したCPU，通称「TD4」の写真です．

![TD4](https://user-images.githubusercontent.com/40142697/126314322-bf08bfb4-6187-4805-91bc-f43602e3e140.JPG)

![TD4-over](https://user-images.githubusercontent.com/40142697/126593570-c54fb009-1256-47f9-b67f-88783ade6222.JPG)

本の内容としては，それほど難しいというわけでもないのですが，すぐに理解できるような内容でもなく，何度か噛みしめるように読むことで理解が深まっていった気がします．

半田付けについては中学生の頃に授業で作成した手回しラジオ以来だったことと，半田付けする必要のある電子部品の数が多いということもあって，集中力が試されるので，難易度としてはこちらのほうが高かった気がします．

また，基板についてですが，ユニバーサル基板などを利用して回路図から自分で実装するのは初心者には厳しいなということで，Boothにてdip-factory様が販売されておられるこのTD4を実装するために作られたプリント基板を利用して作成しています．[こちらで購入できます．](https://dip-factory.booth.pm/items/2093868)

## **TD4というCPUについて**

作成したTD4について，それぞれの場所がどのような処理を行っているのか詳しく説明していこうと思います．

電子工作などについては初心者なので，本の内容を引用したり，**初心者なりに本の内容を解釈して書いています**ので，間違っていることがありましたら教えてください．

> ### **リセットとクロック**

> - リセット回路

> 以下，電圧がLowであることを表すLとして記述し，電圧がHighであることを表すHとして記述します．

> 今回作成したTD4では，L信号が送信されるとリセットされるような仕様になっており，一般的なコンピューターと同じように，電源がオンになったら一時的にL信号を出力する回路を用意しています．

> リセットが行われる仕組みとしては，まず電源がオンになることによってコンデンサの電圧が上昇をはじめ，バケツに水を溜めるようにコンデンサの中に電力が溜まっていきます．そこでリセット回路に繋がるように設置したスイッチを押すことでバケツに溜まった水が放出されるように電圧が下がっていき（所謂放電状態になる），電圧が0VになることでL信号を出しリセットが行われるという流れです．

> - クロック回路

> 先述のリセット回路を利用して，電圧が溜まりH信号が流れたあと，放電を行いL信号が流れるという流れを繰り返すことでL信号とH信号のクロック信号が流れるようになります．

> このクロック信号をこれまでは手動でスイッチをポチポチして行っていたのを発振回路を利用することによって，1Hzのクロック回路としてクロック信号が流れるようになっています．

> ### **ROM**

> TD4ではROMをDIPスイッチで自作しており，CPU側が8bitを読み込み単位としてROMに少しずつ記憶されている番地を指定する信号であるアドレスバスや，吐き出されるデータを流す信号であるデータバスなどの内容を読み込ませてもらってるという流れになっています．

> ちなみに，DIPスイッチとダイオードを沢山はんだ付けする作業に骨が折れます．

> ### **レジスタ**

> TD4は4bitCPUであり，演算とデータ移動は4bit単位で行われます．そして，演算用のレジスタはAとBの二つで構成されています．

> これらのレジスタにいい感じの命令を書き込み転送させるようにしています．

> ### **ALUとプログラムカウンタ**

> - ALU

> TD4ではALUを加算器を代用して処理を行うような仕様になっています．加算器は言葉の通り足し算をする回路のことです．

> 既に実行できるようになっている転送命令のデータの流れにALUを割り込ませることで演算命令が追加されました．

> ちなみに，加算器をALUとして代用していることによって加算しかできない状態になっており，あるレジスタから他のレジスタへ転送するような命令を実行すると，途中に加算器を使っていることによってレジスタにオペレーションコード以外のイミディエイトデータが追加されて他のレジスタに転送されてしまうので，そこらへんをいい感じにするためにイミディエイトデータを ``0000`` としておけばいい感じになってレジスタに転送されるようになっています．

> - プログラムカウンタ

> CPUは実行する命令がどこのアドレスに格納されているかを把握する必要があり，現在の命令のアドレスを指し示す役割を担うのがプログラムカウンタです．

> また，このプログラムカウンタは，ROMに格納された命令を上から順番に読み込んでいき，その命令が完了するたびにカウントアップすることによって実現しています．

> ほかにも，プログラムカウンタは単純にカウントアップするだけではなく，CPUがジャンプ命令を実行した際に指定された番地へ飛ぶことも可能です．

> - I/Oポート

> TD4では4bitの出力ポートを備えており，データを出力すると1や0，もしくはH信号やL信号などが出力されるようになっています．

> プログラムからLEDを付けたり消したりするためには，レジスタの出力に直接くっつけることで出力として目に見える形にしています．

> 入力ポートについては上記の出力ポートを実装する過程でいい感じに実装されちゃいます．（理解できなかったので是非本で確認してみてください．）

> ### **命令デコーダ**

> ROMに格納されているオペレーションコードを取り出し，オペレーションコードから実行部への指示に変換する回路のことを命令デコーダといい，命令デコーダの指示でCPUの各部が動作するようになっています．

> 本の挿絵にも書かれていましたが，友達に「温泉に行きたい」と言われたので旅館の予約や新幹線の予約などをこちらで指示してあげるようなイメージです．中間管理職であり，オペレーションコードの言いなりという感じです．

## **終わりに**

CPUを自分で作ってみることによって，CPUがどんなことを行っているのか体系的に学習することが出来たので良かったと思いました．

また，コンピュータサイエンス分野の学習に繋がることも沢山得られたので，コンピュータサイエンス分野に興味のある方におススメしたい一冊だなと感じました．